{"version":3,"file":"index.js","sources":["../src/js/pixabay-api.js","../src/js/render-functions.js","../src/main.js"],"sourcesContent":["import axios from 'axios';\n\nexport const PER_PAGE = 15;\n\nconst API_KEY = '53062520-ab6df8030023bb65348d73bcb';\nconst BASE_URL = 'https://pixabay.com/api/';\n\n// (опційно) створюємо інстанс з базовими параметрами для майбутніх багаторазових запитів\nconst api = axios.create({\n  baseURL: BASE_URL,\n  params: {\n    key: API_KEY,\n    image_type: 'photo',\n    orientation: 'horizontal',\n    safesearch: true,\n  },\n});\n\n/**\n * Пошук зображень на Pixabay\n * @param {string} query - пошуковий рядок\n * @param {number} page  - номер сторінки (починаємо з 1)\n * @param {number} perPage - кількість елементів на сторінці (дефолт 15)\n * @returns {Promise<{hits: any[], totalHits: number}>}\n */\nexport async function fetchImages(query, page = 1, perPage = PER_PAGE) {\n  const { data } = await api.get('', {\n    params: {\n      q: query,\n      page,\n      per_page: perPage, // <--використовуємо аргумент\n    },\n  });\n  return data; // { total, totalHits, hits }\n}\n","export function buildCardsMarkup(hits) {\n  return hits\n    .map(\n      ({\n        webformatURL,\n        largeImageURL,\n        tags,\n        likes,\n        views,\n        comments,\n        downloads,\n      }) => `\n      <li class=\"gallery-item\">\n        <a class=\"gallery-link\" href=\"${largeImageURL}\">\n          <img class=\"gallery-image\" src=\"${webformatURL}\" alt=\"${escapeHtml(\n        tags\n      )}\" loading=\"lazy\" />\n        </a>\n        <ul class=\"meta\">\n          <li><b>Likes:</b> ${likes}</li>\n          <li><b>Views:</b> ${views}</li>\n          <li><b>Comments:</b> ${comments}</li>\n          <li><b>Downloads:</b> ${downloads}</li>\n        </ul>\n      </li>`\n    )\n    .join('');\n}\n\nexport function drawGallery(markup) {\n  document.querySelector('#gallery').insertAdjacentHTML('beforeend', markup);\n}\n\nexport function clearGallery() {\n  document.querySelector('#gallery').innerHTML = '';\n}\n\nexport function toggleLoadMore(show) {\n  const btn = document.querySelector('#load-more');\n  btn.hidden = !show;\n  btn.disabled = false;\n}\n\nexport function showLoader(show) {\n  const spinner = document.querySelector('#loader');\n  spinner.hidden = !show;\n}\n\n// утиліта безпеки для alt/текстів\nfunction escapeHtml(s = '') {\n  return s.replace(\n    /[&<>\"']/g,\n    c =>\n      ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '\"': '&quot;', \"'\": '&#039;' }[\n        c\n      ])\n  );\n}\n","import { fetchImages } from './js/pixabay-api.js';\nimport {\n  buildCardsMarkup,\n  drawGallery,\n  clearGallery,\n  toggleLoadMore,\n  showLoader,\n} from './js/render-functions.js';\n\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\nimport iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\n\nconst form = document.getElementById('search-form');\nconst loadMoreBtn = document.getElementById('load-more');\n\nlet query = '';\nlet page = 1;\nconst PER_PAGE = 15;\nlet totalHits = 0;\nlet lightbox = null;\nlet isLoading = false;\n\nform.addEventListener('submit', onSubmit);\nloadMoreBtn.addEventListener('click', onLoadMore);\n\nasync function onSubmit(e) {\n  e.preventDefault();\n  query = e.currentTarget.elements.query.value.trim();\n\n  if (!query) {\n    iziToast.warning({\n      title: 'Увага',\n      message: 'Введіть пошуковий запит!',\n      position: 'topRight',\n    });\n    return;\n  }\n\n  page = 1;\n  clearGallery();\n  toggleLoadMore(false);\n  await loadImages();\n}\n\nasync function onLoadMore() {\n  if (isLoading) return;\n  page += 1;\n  await loadImages(true);\n}\n\nasync function loadImages(isLoadMore = false) {\n  isLoading = true;\n  showLoader(true);\n  loadMoreBtn.disabled = true;\n\n  try {\n    const data = await fetchImages(query, page, PER_PAGE);\n    const hits = data?.hits ?? [];\n\n    if (hits.length === 0 && page === 1) {\n      iziToast.info({\n        title: 'Упс!',\n        message:\n          'За цим запитом нічого не знайдено. Спробуйте інше ключове слово.',\n        position: 'topRight',\n      });\n      toggleLoadMore(false);\n      return; // <- важливо, але обов’язково сховати лоадер у finally\n    }\n\n    const markup = buildCardsMarkup(hits);\n    drawGallery(markup);\n\n    // SimpleLightbox\n    if (!lightbox) {\n      lightbox = new SimpleLightbox('.gallery a', {\n        captionsData: 'alt',\n        captionDelay: 250,\n      });\n    } else {\n      lightbox.refresh();\n    }\n\n    totalHits = data?.totalHits ?? 0;\n    const totalPages = Math.ceil(totalHits / PER_PAGE);\n\n    // кнопка load more (показуємо тільки якщо ще є сторінки)\n    toggleLoadMore(page < totalPages);\n\n    if (page >= totalPages && page !== 1) {\n      iziToast.info({\n        title: 'Кінець колекції',\n        message: \"We're sorry, but you've reached the end of search results.\",\n        position: 'bottomCenter',\n      });\n    }\n\n    if (isLoadMore) smoothScroll();\n  } catch (error) {\n    iziToast.error({\n      title: 'Помилка',\n      message: error?.message || 'Something went wrong',\n      position: 'topRight',\n    });\n  } finally {\n    showLoader(false);\n    loadMoreBtn.disabled = false;\n    isLoading = false;\n  }\n}\n\nfunction smoothScroll() {\n  const firstCard = document.querySelector('.gallery-item');\n  if (!firstCard) return;\n  const { height } = firstCard.getBoundingClientRect();\n  window.scrollBy({ top: height * 2, behavior: 'smooth' });\n}\n"],"names":["PER_PAGE","API_KEY","BASE_URL","api","axios","fetchImages","query","page","perPage","data","buildCardsMarkup","hits","webformatURL","largeImageURL","tags","likes","views","comments","downloads","escapeHtml","drawGallery","markup","clearGallery","toggleLoadMore","show","btn","showLoader","spinner","s","c","form","loadMoreBtn","totalHits","lightbox","isLoading","onSubmit","onLoadMore","e","iziToast","loadImages","isLoadMore","SimpleLightbox","totalPages","smoothScroll","error","firstCard","height"],"mappings":"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"}