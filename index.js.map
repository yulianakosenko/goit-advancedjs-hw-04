{"version":3,"file":"index.js","sources":["../src/js/pixabay-api.js","../src/js/render-functions.js","../src/main.js"],"sourcesContent":["import axios from 'axios';\r\n\r\nexport const PER_PAGE = 15;\r\n\r\nconst API_KEY = '53062520-ab6df8030023bb65348d73bcb';\r\nconst BASE_URL = 'https://pixabay.com/api/';\r\n\r\n// (опційно) створюємо інстанс з базовими параметрами\r\nconst api = axios.create({\r\n  baseURL: BASE_URL,\r\n  params: {\r\n    key: API_KEY,\r\n    image_type: 'photo',\r\n    orientation: 'horizontal',\r\n    safesearch: true,\r\n  },\r\n});\r\n\r\n/**\r\n * Пошук зображень на Pixabay\r\n * @param {string} query - пошуковий рядок\r\n * @param {number} page  - номер сторінки (починаємо з 1)\r\n * @param {number} perPage - кількість елементів на сторінці (дефолт 15)\r\n * @returns {Promise<{hits: any[], totalHits: number}>}\r\n */\r\nexport async function fetchImages(query, page = 1, perPage = PER_PAGE) {\r\n  const { data } = await api.get('', {\r\n    params: {\r\n      q: query,\r\n      page,\r\n      per_page: perPage, // <-- тепер використовуємо аргумент\r\n    },\r\n  });\r\n  return data; // { total, totalHits, hits }\r\n}\r\n","export function buildCardsMarkup(hits) {\r\n  return hits\r\n    .map(\r\n      ({\r\n        webformatURL,\r\n        largeImageURL,\r\n        tags,\r\n        likes,\r\n        views,\r\n        comments,\r\n        downloads,\r\n      }) => `\r\n      <li class=\"gallery-item\">\r\n        <a class=\"gallery-link\" href=\"${largeImageURL}\">\r\n          <img class=\"gallery-image\" src=\"${webformatURL}\" alt=\"${escapeHtml(\r\n        tags\r\n      )}\" loading=\"lazy\" />\r\n        </a>\r\n        <ul class=\"meta\">\r\n          <li><b>Likes:</b> ${likes}</li>\r\n          <li><b>Views:</b> ${views}</li>\r\n          <li><b>Comments:</b> ${comments}</li>\r\n          <li><b>Downloads:</b> ${downloads}</li>\r\n        </ul>\r\n      </li>`\r\n    )\r\n    .join('');\r\n}\r\n\r\nexport function drawGallery(markup) {\r\n  document.querySelector('#gallery').insertAdjacentHTML('beforeend', markup);\r\n}\r\n\r\nexport function clearGallery() {\r\n  document.querySelector('#gallery').innerHTML = '';\r\n}\r\n\r\nexport function toggleLoadMore(show) {\r\n  const btn = document.querySelector('#load-more');\r\n  btn.hidden = !show;\r\n  btn.disabled = false;\r\n}\r\n\r\nexport function showLoader(show) {\r\n  const spinner = document.querySelector('#loader');\r\n  spinner.hidden = !show;\r\n}\r\n\r\n// утиліта безпеки для alt/текстів\r\nfunction escapeHtml(s = '') {\r\n  return s.replace(\r\n    /[&<>\"']/g,\r\n    c =>\r\n      ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '\"': '&quot;', \"'\": '&#039;' }[\r\n        c\r\n      ])\r\n  );\r\n}\r\n","import { fetchImages } from './js/pixabay-api.js';\r\nimport {\r\n  buildCardsMarkup,\r\n  drawGallery,\r\n  clearGallery,\r\n  toggleLoadMore,\r\n  showLoader,\r\n} from './js/render-functions.js';\r\n\r\nimport SimpleLightbox from 'simplelightbox';\r\nimport 'simplelightbox/dist/simple-lightbox.min.css';\r\nimport iziToast from 'izitoast';\r\nimport 'izitoast/dist/css/iziToast.min.css';\r\n\r\nconst form = document.getElementById('search-form');\r\nconst loadMoreBtn = document.getElementById('load-more');\r\n\r\nlet query = '';\r\nlet page = 1;\r\nconst PER_PAGE = 15;\r\nlet totalHits = 0;\r\nlet lightbox = null;\r\nlet isLoading = false;\r\n\r\nform.addEventListener('submit', onSubmit);\r\nloadMoreBtn.addEventListener('click', onLoadMore);\r\n\r\nasync function onSubmit(e) {\r\n  e.preventDefault();\r\n  query = e.currentTarget.elements.query.value.trim();\r\n\r\n  if (!query) {\r\n    iziToast.warning({\r\n      title: 'Увага',\r\n      message: 'Введіть пошуковий запит!',\r\n      position: 'topRight',\r\n    });\r\n    return;\r\n  }\r\n\r\n  page = 1;\r\n  clearGallery();\r\n  toggleLoadMore(false);\r\n  await loadImages();\r\n}\r\n\r\nasync function onLoadMore() {\r\n  if (isLoading) return;\r\n  page += 1;\r\n  await loadImages(true);\r\n}\r\n\r\nasync function loadImages(isLoadMore = false) {\r\n  isLoading = true;\r\n  showLoader(true);\r\n  loadMoreBtn.disabled = true;\r\n\r\n  try {\r\n    const data = await fetchImages(query, page, PER_PAGE);\r\n    const hits = data?.hits ?? [];\r\n\r\n    if (hits.length === 0 && page === 1) {\r\n      iziToast.info({\r\n        title: 'Упс!',\r\n        message:\r\n          'За цим запитом нічого не знайдено. Спробуйте інше ключове слово.',\r\n        position: 'topRight',\r\n      });\r\n      toggleLoadMore(false);\r\n      return; // <- важливо, але обов’язково сховати лоадер у finally\r\n    }\r\n\r\n    const markup = buildCardsMarkup(hits);\r\n    drawGallery(markup);\r\n\r\n    // SimpleLightbox\r\n    if (!lightbox) {\r\n      lightbox = new SimpleLightbox('.gallery a', {\r\n        captionsData: 'alt',\r\n        captionDelay: 250,\r\n      });\r\n    } else {\r\n      lightbox.refresh();\r\n    }\r\n\r\n    totalHits = data?.totalHits ?? 0;\r\n    const totalPages = Math.ceil(totalHits / PER_PAGE);\r\n\r\n    // кнопка load more (показуємо тільки якщо ще є сторінки)\r\n    toggleLoadMore(page < totalPages);\r\n\r\n    if (page >= totalPages && page !== 1) {\r\n      iziToast.info({\r\n        title: 'Кінець колекції',\r\n        message: \"We're sorry, but you've reached the end of search results.\",\r\n        position: 'bottomCenter',\r\n      });\r\n    }\r\n\r\n    if (isLoadMore) smoothScroll();\r\n  } catch (error) {\r\n    iziToast.error({\r\n      title: 'Помилка',\r\n      message: error?.message || 'Something went wrong',\r\n      position: 'topRight',\r\n    });\r\n  } finally {\r\n    showLoader(false);\r\n    loadMoreBtn.disabled = false;\r\n    isLoading = false;\r\n  }\r\n}\r\n\r\nfunction smoothScroll() {\r\n  const firstCard = document.querySelector('.gallery-item');\r\n  if (!firstCard) return;\r\n  const { height } = firstCard.getBoundingClientRect();\r\n  window.scrollBy({ top: height * 2, behavior: 'smooth' });\r\n}\r\n"],"names":["PER_PAGE","API_KEY","BASE_URL","api","axios","fetchImages","query","page","perPage","data","buildCardsMarkup","hits","webformatURL","largeImageURL","tags","likes","views","comments","downloads","escapeHtml","drawGallery","markup","clearGallery","toggleLoadMore","show","btn","showLoader","spinner","s","c","form","loadMoreBtn","totalHits","lightbox","isLoading","onSubmit","onLoadMore","e","iziToast","loadImages","isLoadMore","SimpleLightbox","totalPages","smoothScroll","error","firstCard","height"],"mappings":"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"}